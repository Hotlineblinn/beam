# TravelTimeGoogleStatistic: Build database of the computed routes
Issue [#2872](https://github.com/LBNL-UCB-STI/beam/issues/2872)  
PR: [#2904](https://github.com/LBNL-UCB-STI/beam/pull/2904)

## GoogleRoutesDB

[GoogleRoutesDB.scala](../GoogleRoutesDB.scala) populates a [PostgreSQL](https://www.postgresql.org/) database
set up with [PostGIS extension](https://postgis.net/).

A database must be prepared beforehand:
1. Create a database: `CREATE DATABASE google_routes_db WITH ENCODING 'UTF8';`
2. Create PostGIS extension: `CREATE EXTENSION postgis;` 

All necessary tables are created automatically.

### How to run?
```
./gradlew :execute \
  -PmainClass=beam.utils.google_routes_db.GoogleRoutesDB \
  -PappArgs="['--config','src/main/scala/beam/utils/google_routes_db/config/google_routes_db.conf']" \
  -PlogbackCfg=logback.xml
```

### What is the output?
1. `gr_route` table - some common data. Structure: [sql.GoogleRoute](../sql/package.scala#L65)
2. `gr_route_leg` table - route leg properties. Structure: [sql.GoogleRouteLeg](../sql/package.scala#L118)

_Note:_ our data contains 1 leg per route response.

## ReqRespMapping
[ReqRespMapping.scala](../ReqRespMapping.scala) performs some calculations to reconstruct request-response relationship.

### How to run?
```
./gradlew :execute \
  -PmainClass=beam.utils.google_routes_db.ReqRespMapping \
  -PappArgs="['--config','src/main/scala/beam/utils/google_routes_db/config/google_routes_db.conf']" \
  -PlogbackCfg=logback.xml
```

### What is the output?
[ReqRespMapping.scala](../ReqRespMapping.scala) creates `ReqRespMapping.csv` in current directory. Detailed explanation: [Mapping between maps.googleapi.responses.json and  googleTravelTimeEstimation.csv](ReqRespMapping.md).

## Config
Both `GoogleRoutesDB` and `ReqRespMapping` use [GoogleRoutesDBConfig](../config/GoogleRoutesDBConfig.scala). It is generated by [carueda/tscfg](https://github.com/carueda/tscfg) using a gradle task. See the template [google_routes_db-template.conf](../config/google_routes_db-template.conf) for instructions and intuition.

## Links:
* [Mapping between maps.googleapi.responses.json and  googleTravelTimeEstimation.csv](ReqRespMapping.md)
